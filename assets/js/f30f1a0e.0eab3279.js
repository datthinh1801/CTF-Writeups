"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4750],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return g}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),m=s(n),g=a,d=m["".concat(l,".").concat(g)]||m[g]||p[g]||i;return n?r.createElement(d,o(o({ref:t},u),{},{components:n})):r.createElement(d,o({ref:t},u))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var s=2;s<i;s++)o[s]=n[s];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3055:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return u},default:function(){return m}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],c={},l="Lab: 2FA broken logic",s={unversionedId:"PortSwigger/Authentication/Lab 08",id:"PortSwigger/Authentication/Lab 08",isDocsHomePage:!1,title:"Lab: 2FA broken logic",description:"Task",source:"@site/docs/PortSwigger/Authentication/Lab 08.md",sourceDirName:"PortSwigger/Authentication",slug:"/PortSwigger/Authentication/Lab 08",permalink:"/Writeups/docs/PortSwigger/Authentication/Lab 08",editUrl:"https://github.com/datthinh1801/Writupes/tree/main/website/docs/PortSwigger/Authentication/Lab 08.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lab: 2FA simple bypass",permalink:"/Writeups/docs/PortSwigger/Authentication/Lab 07"},next:{title:"Lab: 2FA bypass using a brute-force attack",permalink:"/Writeups/docs/PortSwigger/Authentication/Lab 09"}},u=[{value:"Task",id:"task",children:[]},{value:"Solution",id:"solution",children:[]}],p={toc:u};function m(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"lab-2fa-broken-logic"},"Lab: 2FA broken logic"),(0,i.kt)("h2",{id:"task"},"Task"),(0,i.kt)("p",null,"This lab's two-factor authentication is vulnerable due to its flawed logic. To solve the lab, access Carlos's account page."),(0,i.kt)("p",null,"Your credentials: ",(0,i.kt)("inlineCode",{parentName:"p"},"wiener"),":",(0,i.kt)("inlineCode",{parentName:"p"},"peter"),(0,i.kt)("br",{parentName:"p"}),"\n","Victim's username: ",(0,i.kt)("inlineCode",{parentName:"p"},"carlos"),(0,i.kt)("br",{parentName:"p"}),"\n","You also have access to the email server to receive your 2FA verification code."),(0,i.kt)("h2",{id:"solution"},"Solution"),(0,i.kt)("p",null,"First, we log in with our credential. Then we are redirected to the second stage at ",(0,i.kt)("inlineCode",{parentName:"p"},"/login2"),":  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130578911-210efd87-5cc0-43ce-ae1d-53151db2fec5.png",alt:"image"})),(0,i.kt)("p",null,"Here, we can see that there is a cookie named ",(0,i.kt)("inlineCode",{parentName:"p"},"verify")," whose value is our username ",(0,i.kt)("inlineCode",{parentName:"p"},"wiener"),".  "),(0,i.kt)("p",null,"Open our email client and enter the security code:  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130579218-b8bfaa07-a896-4522-9bd0-e9fabaf2a134.png",alt:"image"}),"  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130579129-bfd98dba-8ccd-45ec-9c73-505a396e790d.png",alt:"image"}),"  "),(0,i.kt)("p",null,"Logged in successfully.  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130579307-80a6cd74-a8f3-48b2-8358-35eaffb72dee.png",alt:"image"})),(0,i.kt)("p",null,"Above is a normal login procedure. However, this application has a vulnerability that it doesn't check whether the same user performs both stages or not.\nFor this reason, we can use our credential to pass the first stage, and then modify the ",(0,i.kt)("inlineCode",{parentName:"p"},"verify")," cookie to ",(0,i.kt)("inlineCode",{parentName:"p"},"carlos")," and brute-force the 4-digit security code of this user."),(0,i.kt)("p",null,"First, login with our credential:  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130579665-b2a1c7c8-2414-4287-8a30-98ec53642fbe.png",alt:"image"})),(0,i.kt)("p",null,"Second, modify the ",(0,i.kt)("inlineCode",{parentName:"p"},"verify")," cookie value and start brute-forcing the ",(0,i.kt)("inlineCode",{parentName:"p"},"mfa-code"),":  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130579806-5047c54a-3087-446c-b55d-82b0c5f1f0c4.png",alt:"image"}),"  "),(0,i.kt)("p",null,"On the ",(0,i.kt)("strong",{parentName:"p"},"Payloads")," tab, setup the payload options as follows and start attack:  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130580275-5e29ebb8-df4c-414e-b688-6345154bca23.png",alt:"image"})),(0,i.kt)("p",null,"Here, the valid code is ",(0,i.kt)("inlineCode",{parentName:"p"},"1785"),":  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130584687-fe37abf6-b8cd-4f7d-82d3-96d7ccd42db0.png",alt:"image"})),(0,i.kt)("p",null,"Finally, I'll use this code to verify and login as ",(0,i.kt)("inlineCode",{parentName:"p"},"carlos"),":  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130584765-387f4dfa-d68e-444f-9532-c7fab317ec20.png",alt:"image"}),"  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130584813-7a910b20-aecc-492b-bd0b-6ba99c0f943b.png",alt:"image"})),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Solved!")))}m.isMDXComponent=!0}}]);