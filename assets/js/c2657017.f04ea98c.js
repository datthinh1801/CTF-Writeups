"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5259],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return g}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(n),g=a,b=m["".concat(l,".").concat(g)]||m[g]||u[g]||o;return n?r.createElement(b,i(i({ref:t},p),{},{components:n})):r.createElement(b,i({ref:t},p))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},330:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return m}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={},l="Lab: Password reset broken logic",c={unversionedId:"PortSwigger/Authentication/Lab 12",id:"PortSwigger/Authentication/Lab 12",isDocsHomePage:!1,title:"Lab: Password reset broken logic",description:"Task",source:"@site/docs/PortSwigger/Authentication/Lab 12.md",sourceDirName:"PortSwigger/Authentication",slug:"/PortSwigger/Authentication/Lab 12",permalink:"/Writeups/docs/PortSwigger/Authentication/Lab 12",editUrl:"https://github.com/datthinh1801/Writupes/tree/main/website/docs/PortSwigger/Authentication/Lab 12.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lab: Offline password cracking",permalink:"/Writeups/docs/PortSwigger/Authentication/Lab 11"},next:{title:"Lab: Password reset poisoning via middleware",permalink:"/Writeups/docs/PortSwigger/Authentication/Lab 13"}},p=[{value:"Task",id:"task",children:[]},{value:"Solution",id:"solution",children:[]}],u={toc:p};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"lab-password-reset-broken-logic"},"Lab: Password reset broken logic"),(0,o.kt)("h2",{id:"task"},"Task"),(0,o.kt)("p",null,"This lab's password reset functionality is vulnerable. To solve the lab, reset Carlos's password then log in and access his \"My account\" page."),(0,o.kt)("p",null,"Your credentials: ",(0,o.kt)("inlineCode",{parentName:"p"},"wiener"),":",(0,o.kt)("inlineCode",{parentName:"p"},"peter"),(0,o.kt)("br",{parentName:"p"}),"\n","Victim's username: ",(0,o.kt)("inlineCode",{parentName:"p"},"carlos")),(0,o.kt)("h2",{id:"solution"},"Solution"),(0,o.kt)("p",null,"In this application, if we click the ",(0,o.kt)("inlineCode",{parentName:"p"},"Forgot password?")," option, we'll be asked to enter our email to get a ",(0,o.kt)("strong",{parentName:"p"},"reset password link"),".  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/131203208-5ef1fe9f-8606-44a8-9974-69cc318ca1d9.png",alt:"image"}),"  "),(0,o.kt)("p",null,"After that, we'll receive an email with a link to redirect us to the reset password page:  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/131203226-495c90df-3944-4151-bd4f-705780e29bf2.png",alt:"image"}),"  "),(0,o.kt)("p",null,"Click the link and enter a new password.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/131203238-102b40b3-ff2b-4acb-b1f7-11245f49b126.png",alt:"image"}),"  "),(0,o.kt)("p",null,"Here, when I click the ",(0,o.kt)("strong",{parentName:"p"},"Submit")," button, this POST request is sent:  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/131203257-802d4494-ce36-499d-9551-c3dca8ca2333.png",alt:"image"}),"  "),(0,o.kt)("p",null,"On the theory page, we are mentioned that:"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"However, some websites fail to also validate the token again when the reset form is submitted. In this case, an attacker could simply visit the reset form from their own account, delete the token, and leverage this page to reset an arbitrary user's password.  ")),(0,o.kt)("p",null,"So let's try to remove the ",(0,o.kt)("inlineCode",{parentName:"p"},"temp-forgot-password-token")," and change the ",(0,o.kt)("inlineCode",{parentName:"p"},"username")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"carlos"),".  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/131203330-9041e854-4ab8-40e0-b6f0-1787ba6beb3f.png",alt:"image"})),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"This is not what we expected.  ")),(0,o.kt)("p",null,"So, let's try another way: Keep the token but change the ",(0,o.kt)("inlineCode",{parentName:"p"},"username")," parameter to ",(0,o.kt)("inlineCode",{parentName:"p"},"carlos"),":  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/131203377-71a05cf4-77d5-4cf8-b4e3-d43236770139.png",alt:"image"}),"  "),(0,o.kt)("p",null,"And ",(0,o.kt)("inlineCode",{parentName:"p"},"302 Found"),"!  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/131203384-df4e3bb7-2c36-4328-b350-684e45b95abf.png",alt:"image"})),(0,o.kt)("p",null,"Now, let's login as ",(0,o.kt)("inlineCode",{parentName:"p"},"carlos")," with our new password.  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/131203397-c27af4d6-7292-4217-a2c7-b7e1637ff261.png",alt:"image"}),"  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/131203402-18064c42-8bf9-43ad-a432-a92c3671c405.png",alt:"image"})),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Solved!")))}m.isMDXComponent=!0}}]);